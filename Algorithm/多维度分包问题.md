# 多维度分包问题

## NFDH

NFDH(Next Fit Decreasing Height) 是 Meir and Moser 在 1968 年引入的一种用于解决将 $d$ 个维度的立方体装入 $d$ 个维度的箱子的算法

这个算法通过将这些立方体按照容积进行降序排列，以此放入箱子中，构造对应的层级，后续的放入将以这个层级为基础，按照同样的逻辑进行放入，直到无法放入。如果这些立方体的边长是通过 $x1,x2,x3……$ 来构建的，并且打包到的箱子的边长为 $a1,a2,a3……$，那么只要这些箱子的总体积不超过 $x_{1}^d + \prod \limits_{i=0}^d(a_{i} - x_{1})$，就可以放入一个箱子中

对于 $d=2$ （将正方形打包到矩形），这个算法的流程如下：最大的正方形将被放入到矩形的左下角，那么第一层级的高度就是就是这个被放入的正方形的边长；下一个更大的正方形会放入到这个层级，也就是底边和第一个正方形上边接触，直到放不下，示例图如下：

![DFDH.png](https://s2.loli.net/2025/05/18/XAHKiuokLat6p2S.png)

这个算法也被用于将矩形打包到矩形，和正方形的处理一样，将每个待打包的矩形按照高度降序排列，再按照上文的算法步骤做相同的处理。

当将这些矩形按照 NFDH 算法进行打包时，如果不设定高度限制，那么在最坏情况下，打包后的高度最大为 $2 * h + \epsilon$，其中 $h$ 为最优排列后的高度，因此这个算法的最坏情况比为 $3$

定理：任意一组边长最多为 $x$ 且总面积为 $A$ 的矩形，若 $a \geq x$ 并且 $a*b \geq 2A + a^2 / 8$ ，那么则可以将它塞入任意大小为 $a*b$ 的矩形中，这个结果为最佳的结果

当将矩形打包到一个单位正方形是，如果每个矩形的最大边长不超过 $1$，那么，任意一组总面积不超过 $7/16$ 的矩形集合都可以打包到单位正方形中

## 条带打包

### 在线打包

Baker 和 Schwartz 首次研究了二维的在线条带打包，他们引入一类名为 "货架算法" 的算法。一个 "货架算法" 使用一个一维的打包算法$A$和一个参数  $\alpha \in (0, 1)$ ，每个物品按照高度进行分类：如果这个物品的高度在 $[\alpha^{s-1}, \alpha^s]$ 区间内，那么这个这个物品就归类为 $s$。每种类别的物品都会按照不同的类别的货架通过 $A$ 进行打包或者开启一个新的货架。注意，这里的算法 $A$ 不一定必须是在线算法

### 离线结果

分段条带打包：矩形集合 $L$ 的分段式条带打包是一个通过将  $L$ 中的一些矩形通过水平细分后得到的矩形集合 $L'$。对于每一个矩形 $(w_{i},h_{i})$ 被替换为矩形序列 $(w_i,h_{i}^1),(w_i,h_{i}^2),……(w_i,h_{i}^{k_i})$，即 $\sum_{j=1}^{k_i}h_{i}^{j}=h_i$

在 $L$仅包含 $(\epsilon' , 1]$  $(\epsilon' > 0)$ 中 $m$ 个不同宽度的物品的情况下，可以在多项式时间内找到 $L$ 位于最分段式条带包装 $FSP(L)$ 之一的分段式带包装。除此之外，只需要损失一个 $2m$ 个附加常数，就可以将这个分段式条带包装转换成一般的条带式包装。用 $OPT(L)$ 表示 $L$ 的最佳条带填料高度，我们可以得到如下结论：最大打包高度为 $FSP(L) + 1 + 2m \leq OPT(L) + 2m + 1$

修改后的 NFDH：这是一种将细长物品（每个物品宽度最大为 $\epsilon'$）打包到上文描述的较宽物体包装中的方法。传统的 NFDH 打包方式会在条带的右侧留下空的矩形，通过 NFDH 将细长的物件打包到这些空的矩形中（以高度最高的细长物件作为首个填充物件）。当所有矩形都使用完毕后，剩余的物品（如果有）将在整个条带宽度上使用 NFDH 包装在包装上方



## 算法

1. 移除 `list` 中所有大小小于 $\epsilon$ 的元素
2. 将所有的元素分区到 $k$ 的组中，其中 $k=1/\epsilon^2$ ，将每个分组中的元素向上进行舍入，视为每个组中物件的最大大小
3. 找到最优的打包方式
4. 使用此打包方式打包原始物品的尺寸
5. 对大小小于 $\epsilon$ 的物件，使用 `First-Fit` 算法进行打包



